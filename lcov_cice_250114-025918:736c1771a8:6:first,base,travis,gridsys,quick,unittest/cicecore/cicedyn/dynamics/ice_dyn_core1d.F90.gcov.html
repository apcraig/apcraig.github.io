<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - 250114-025918:736c1771a8:6:first,base,travis,gridsys,quick,unittest - cicecore/cicedyn/dynamics/ice_dyn_core1d.F90</title>
  <link rel="stylesheet" type="text/css" href="../../../gcov.css">
</head>

<body>

          <table width="100%" border=0 cellspacing=0 cellpadding=0>
            <tr><td class="title">LCOV - code coverage report</td></tr>
            <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>

            <tr>
              <td width="100%">
                <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="10%" class="headerValue"><a href="../../../index.html">top level</a> - <a href="index.html">cicecore/cicedyn/dynamics</a> - ice_dyn_core1d.F90<span style="font-size: 80%;"> (source / <a href="ice_dyn_core1d.F90.func-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="5%"></td>
            <td width="5%" class="headerCovTableHead">Coverage</td>
            <td width="5%" class="headerCovTableHead" title="Covered + Uncovered code">Total</td>
            <td width="5%" class="headerCovTableHead" title="Exercised code only">Hit</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">250114-025918:736c1771a8:6:first,base,travis,gridsys,quick,unittest</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntryLo">37.18&nbsp;%</td>
            <td class="headerCovTableEntry">234</td>
            <td class="headerCovTableEntry">87</td>
          </tr>
          <tr>
            <td class="headerItem">Test Date:</td>
            <td class="headerValue">2025-01-14 04:35:23</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntryHi">100.00&nbsp;%</td>
            <td class="headerCovTableEntry">4</td>
            <td class="headerCovTableEntry">4</td>
          </tr>
                  <tr><td><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
                </table>
              </td>
            </tr>

            <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
          </table>

          <table cellpadding=0 cellspacing=0 border=0>
            <tr>
              <td><br></td>
            </tr>
            <tr>
              <td>
<pre class="sourceHeading">            Line data    Source code</pre>
<pre class="source">
<span id="L1"><span class="lineNum">       1</span>              : !===============================================================================</span>
<span id="L2"><span class="lineNum">       2</span>              : ! Copyright (C) 2024, Intel Corporation</span>
<span id="L3"><span class="lineNum">       3</span>              : ! Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<span id="L4"><span class="lineNum">       4</span>              : ! 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<span id="L5"><span class="lineNum">       5</span>              : ! 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<span id="L6"><span class="lineNum">       6</span>              : ! 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<span id="L7"><span class="lineNum">       7</span>              : ! THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span id="L8"><span class="lineNum">       8</span>              : !===============================================================================</span>
<span id="L9"><span class="lineNum">       9</span>              : </span>
<span id="L10"><span class="lineNum">      10</span>              : !===============================================================================</span>
<span id="L11"><span class="lineNum">      11</span>              : !</span>
<span id="L12"><span class="lineNum">      12</span>              : ! Elastic-viscous-plastic sea ice dynamics model</span>
<span id="L13"><span class="lineNum">      13</span>              : ! Computes ice velocity and deformation</span>
<span id="L14"><span class="lineNum">      14</span>              : !</span>
<span id="L15"><span class="lineNum">      15</span>              : ! See:</span>
<span id="L16"><span class="lineNum">      16</span>              : !</span>
<span id="L17"><span class="lineNum">      17</span>              : ! Hunke, E. C., and J. K. Dukowicz (1997). An elastic-viscous-plastic model</span>
<span id="L18"><span class="lineNum">      18</span>              : ! for sea ice dynamics. J. Phys. Oceanogr., 27, 1849-1867.</span>
<span id="L19"><span class="lineNum">      19</span>              : !</span>
<span id="L20"><span class="lineNum">      20</span>              : ! Hunke, E. C. (2001).  Viscous-Plastic Sea Ice Dynamics with the EVP Model:</span>
<span id="L21"><span class="lineNum">      21</span>              : ! Linearization Issues. J. Comput. Phys., 170, 18-38.</span>
<span id="L22"><span class="lineNum">      22</span>              : !</span>
<span id="L23"><span class="lineNum">      23</span>              : ! Hunke, E. C., and J. K. Dukowicz (2002).  The Elastic-Viscous-Plastic</span>
<span id="L24"><span class="lineNum">      24</span>              : ! Sea Ice Dynamics Model in General Orthogonal Curvilinear Coordinates</span>
<span id="L25"><span class="lineNum">      25</span>              : ! on a Sphere - Incorporation of Metric Terms. Mon. Weather Rev.,</span>
<span id="L26"><span class="lineNum">      26</span>              : ! 130, 1848-1865.</span>
<span id="L27"><span class="lineNum">      27</span>              : !</span>
<span id="L28"><span class="lineNum">      28</span>              : ! Hunke, E. C., and J. K. Dukowicz (2003).  The sea ice momentum</span>
<span id="L29"><span class="lineNum">      29</span>              : ! equation in the free drift regime.  Los Alamos Tech. Rep. LA-UR-03-2219.</span>
<span id="L30"><span class="lineNum">      30</span>              : !</span>
<span id="L31"><span class="lineNum">      31</span>              : ! Hibler, W. D. (1979). A dynamic thermodynamic sea ice model. J. Phys.</span>
<span id="L32"><span class="lineNum">      32</span>              : ! Oceanogr., 9, 817-846.</span>
<span id="L33"><span class="lineNum">      33</span>              : !</span>
<span id="L34"><span class="lineNum">      34</span>              : ! Bouillon, S., T. Fichefet, V. Legat and G. Madec (2013).  The</span>
<span id="L35"><span class="lineNum">      35</span>              : ! elastic-viscous-plastic method revisited.  Ocean Model., 71, 2-12.</span>
<span id="L36"><span class="lineNum">      36</span>              : !</span>
<span id="L37"><span class="lineNum">      37</span>              : ! author: Elizabeth C. Hunke, LANL</span>
<span id="L38"><span class="lineNum">      38</span>              : !</span>
<span id="L39"><span class="lineNum">      39</span>              : ! 2003: Vectorized by Clifford Chen (Fujitsu) and William Lipscomb (LANL)</span>
<span id="L40"><span class="lineNum">      40</span>              : ! 2004: Block structure added by William Lipscomb</span>
<span id="L41"><span class="lineNum">      41</span>              : ! 2005: Removed boundary calls for stress arrays (WHL)</span>
<span id="L42"><span class="lineNum">      42</span>              : ! 2006: Streamlined for efficiency by Elizabeth Hunke</span>
<span id="L43"><span class="lineNum">      43</span>              : !       Converted to free source form (F90)</span>
<span id="L44"><span class="lineNum">      44</span>              : !===============================================================================</span>
<span id="L45"><span class="lineNum">      45</span>              : ! 2023: Intel</span>
<span id="L46"><span class="lineNum">      46</span>              : !       Refactored for SIMD code generation</span>
<span id="L47"><span class="lineNum">      47</span>              : !       Refactored to reduce memory footprint</span>
<span id="L48"><span class="lineNum">      48</span>              : !       Refactored to support explicit inlining</span>
<span id="L49"><span class="lineNum">      49</span>              : !       Refactored the OpenMP parallelization (classic loop inlined w. scoping)</span>
<span id="L50"><span class="lineNum">      50</span>              : !       Refactored to support OpenMP GPU offloading</span>
<span id="L51"><span class="lineNum">      51</span>              : !       Refactored to allow private subroutines in stress to become pure</span>
<span id="L52"><span class="lineNum">      52</span>              : !===============================================================================</span>
<span id="L53"><span class="lineNum">      53</span>              : !===============================================================================</span>
<span id="L54"><span class="lineNum">      54</span>              : ! 2023: DMI</span>
<span id="L55"><span class="lineNum">      55</span>              : !       Updated to match requirements from CICE</span>
<span id="L56"><span class="lineNum">      56</span>              : !===============================================================================</span>
<span id="L57"><span class="lineNum">      57</span>              : ! module is based on benchmark test v2c</span>
<span id="L58"><span class="lineNum">      58</span>              : </span>
<span id="L59"><span class="lineNum">      59</span>              : module ice_dyn_core1d</span>
<span id="L60"><span class="lineNum">      60</span>              : </span>
<span id="L61"><span class="lineNum">      61</span>              :   use ice_dyn_shared, only: e_factor, epp2i, capping</span>
<span id="L62"><span class="lineNum">      62</span>              :   use ice_constants, only: c1</span>
<span id="L63"><span class="lineNum">      63</span>              : </span>
<span id="L64"><span class="lineNum">      64</span>              :   implicit none</span>
<span id="L65"><span class="lineNum">      65</span>              :   private</span>
<span id="L66"><span class="lineNum">      66</span>              : </span>
<span id="L67"><span class="lineNum">      67</span>              :   public :: stress_1d, stepu_1d, calc_diag_1d</span>
<span id="L68"><span class="lineNum">      68</span>              :   contains</span>
<span id="L69"><span class="lineNum">      69</span>              : </span>
<span id="L70"><span class="lineNum">      70</span>              :   ! arguments ------------------------------------------------------------------</span>
<span id="L71"><span class="lineNum">      71</span> <span class="tlaGNC tlaBgGNC">      120960 :   subroutine stress_1d (ee, ne, se, lb, ub,                              &amp;</span></span>
<span id="L72"><span class="lineNum">      72</span> <span class="tlaGNC">      120960 :                         uvel, vvel, dxT, dyT, skipme, strength,          &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L73"><span class="lineNum">      73</span> <span class="tlaGNC">      120960 :                         hte, htn, htem1, htnm1,                          &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L74"><span class="lineNum">      74</span> <span class="tlaGNC">      120960 :                         stressp_1,  stressp_2,  stressp_3,  stressp_4,   &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L75"><span class="lineNum">      75</span> <span class="tlaGNC">      120960 :                         stressm_1,  stressm_2,  stressm_3,  stressm_4,   &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L76"><span class="lineNum">      76</span> <span class="tlaGNC">      120960 :                         stress12_1, stress12_2, stress12_3, stress12_4,  &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L77"><span class="lineNum">      77</span> <span class="tlaGNC">      120960 :                         str1, str2, str3, str4, str5, str6, str7, str8)</span></span>
<span id="L78"><span class="lineNum">      78</span>              : </span>
<span id="L79"><span class="lineNum">      79</span>              :     use ice_kinds_mod</span>
<span id="L80"><span class="lineNum">      80</span>              :     use ice_constants , only: p027, p055, p111, p166, c1p5, &amp;</span>
<span id="L81"><span class="lineNum">      81</span>              :                               p222, p25, p333, p5</span>
<span id="L82"><span class="lineNum">      82</span>              : </span>
<span id="L83"><span class="lineNum">      83</span>              :     use ice_dyn_shared, only: arlx1i, denom1, revp,         &amp;</span>
<span id="L84"><span class="lineNum">      84</span>              :                               deltaminEVP, visc_replpress</span>
<span id="L85"><span class="lineNum">      85</span>              :     !</span>
<span id="L86"><span class="lineNum">      86</span>              :     implicit none</span>
<span id="L87"><span class="lineNum">      87</span>              :     ! arguments ------------------------------------------------------------------</span>
<span id="L88"><span class="lineNum">      88</span>              :     integer (kind=int_kind), intent(in)                           :: lb,ub</span>
<span id="L89"><span class="lineNum">      89</span>              :     integer (kind=int_kind), dimension(:), intent(in), contiguous :: ee,ne,se</span>
<span id="L90"><span class="lineNum">      90</span>              :     logical (kind=log_kind), dimension(:), intent(in), contiguous :: skipme</span>
<span id="L91"><span class="lineNum">      91</span>              :     real    (kind=dbl_kind), dimension(:), intent(in), contiguous ::             &amp;</span>
<span id="L92"><span class="lineNum">      92</span>              :       strength , &amp; ! ice strength (N/m)   ! LCOV_EXCL_LINE</span>
<span id="L93"><span class="lineNum">      93</span>              :       uvel     , &amp; ! x-component of velocity (m/s)   ! LCOV_EXCL_LINE</span>
<span id="L94"><span class="lineNum">      94</span>              :       vvel     , &amp; ! y-component of velocity (m/s)   ! LCOV_EXCL_LINE</span>
<span id="L95"><span class="lineNum">      95</span>              :       dxT      , &amp; ! width of T-cell through the middle (m)   ! LCOV_EXCL_LINE</span>
<span id="L96"><span class="lineNum">      96</span>              :       dyT      , &amp; ! height of T-cell through the middle (m)   ! LCOV_EXCL_LINE</span>
<span id="L97"><span class="lineNum">      97</span>              :       hte      , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L98"><span class="lineNum">      98</span>              :       htn      , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L99"><span class="lineNum">      99</span>              :       htem1    , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L100"><span class="lineNum">     100</span>              :       htnm1</span>
<span id="L101"><span class="lineNum">     101</span>              : </span>
<span id="L102"><span class="lineNum">     102</span>              :     real    (kind=dbl_kind), dimension(:), intent(inout), contiguous :: &amp;</span>
<span id="L103"><span class="lineNum">     103</span>              :       stressp_1, stressp_2, stressp_3, stressp_4 , &amp; ! sigma11+sigma22   ! LCOV_EXCL_LINE</span>
<span id="L104"><span class="lineNum">     104</span>              :       stressm_1, stressm_2, stressm_3, stressm_4 , &amp; ! sigma11-sigma22   ! LCOV_EXCL_LINE</span>
<span id="L105"><span class="lineNum">     105</span>              :       stress12_1,stress12_2,stress12_3,stress12_4    ! sigma12</span>
<span id="L106"><span class="lineNum">     106</span>              : </span>
<span id="L107"><span class="lineNum">     107</span>              :     real    (kind=dbl_kind), dimension(:), intent(inout), contiguous :: &amp;</span>
<span id="L108"><span class="lineNum">     108</span>              :       str1,str2,str3,str4,str5,str6,str7,str8</span>
<span id="L109"><span class="lineNum">     109</span>              : </span>
<span id="L110"><span class="lineNum">     110</span>              :     ! local variables</span>
<span id="L111"><span class="lineNum">     111</span>              :     integer (kind=int_kind) :: iw</span>
<span id="L112"><span class="lineNum">     112</span>              : </span>
<span id="L113"><span class="lineNum">     113</span>              :     real    (kind=dbl_kind) ::                          &amp;</span>
<span id="L114"><span class="lineNum">     114</span> <span class="tlaGNC">        5760 :       divune, divunw, divuse, divusw            ,       &amp; ! divergence   ! LCOV_EXCL_LINE</span></span>
<span id="L115"><span class="lineNum">     115</span> <span class="tlaGNC">        5760 :       tensionne, tensionnw, tensionse, tensionsw,       &amp; ! tension   ! LCOV_EXCL_LINE</span></span>
<span id="L116"><span class="lineNum">     116</span> <span class="tlaGNC">        5760 :       shearne, shearnw, shearse, shearsw        ,       &amp; ! shearing   ! LCOV_EXCL_LINE</span></span>
<span id="L117"><span class="lineNum">     117</span> <span class="tlaGNC">        5760 :       Deltane, Deltanw, Deltase, Deltasw        ,       &amp; ! Delt   ! LCOV_EXCL_LINE</span></span>
<span id="L118"><span class="lineNum">     118</span> <span class="tlaGNC">        5760 :       zetax2ne, zetax2nw, zetax2se, zetax2sw    ,       &amp; ! 2 x zeta (bulk visc)   ! LCOV_EXCL_LINE</span></span>
<span id="L119"><span class="lineNum">     119</span> <span class="tlaGNC">        5760 :       etax2ne, etax2nw, etax2se, etax2sw        ,       &amp; ! 2 x eta (shear visc)   ! LCOV_EXCL_LINE</span></span>
<span id="L120"><span class="lineNum">     120</span> <span class="tlaGNC">        5760 :       rep_prsne, rep_prsnw, rep_prsse, rep_prssw,       &amp; ! replacement pressure   ! LCOV_EXCL_LINE</span></span>
<span id="L121"><span class="lineNum">     121</span> <span class="tlaGNC">        5760 :       ssigpn, ssigps, ssigpe, ssigpw            ,       &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L122"><span class="lineNum">     122</span> <span class="tlaGNC">        5760 :       ssigmn, ssigms, ssigme, ssigmw            ,       &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L123"><span class="lineNum">     123</span> <span class="tlaGNC">        5760 :       ssig12n, ssig12s, ssig12e, ssig12w        ,       &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L124"><span class="lineNum">     124</span> <span class="tlaGNC">        5760 :       ssigp1, ssigp2, ssigm1, ssigm2, ssig121, ssig122, &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L125"><span class="lineNum">     125</span> <span class="tlaGNC">        5760 :       csigpne, csigpnw, csigpse, csigpsw        ,       &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L126"><span class="lineNum">     126</span> <span class="tlaGNC">        5760 :       csigmne, csigmnw, csigmse, csigmsw        ,       &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L127"><span class="lineNum">     127</span> <span class="tlaGNC">        5760 :       csig12ne, csig12nw, csig12se, csig12sw    ,       &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L128"><span class="lineNum">     128</span> <span class="tlaGNC">        5760 :       str12ew, str12we, str12ns, str12sn        ,       &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L129"><span class="lineNum">     129</span> <span class="tlaGNC">        5760 :       strp_tmp, strm_tmp</span></span>
<span id="L130"><span class="lineNum">     130</span>              : </span>
<span id="L131"><span class="lineNum">     131</span>              :     real    (kind=dbl_kind) ::                          &amp;</span>
<span id="L132"><span class="lineNum">     132</span> <span class="tlaGNC">        5760 :       tmp_uvel_ee, tmp_vvel_se, tmp_vvel_ee,            &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L133"><span class="lineNum">     133</span> <span class="tlaGNC">        5760 :       tmp_vvel_ne, tmp_uvel_ne, tmp_uvel_se,            &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L134"><span class="lineNum">     134</span> <span class="tlaGNC">        5760 :       tmp_uvel_cc, tmp_vvel_cc, tmp_dxT, tmp_dyT,       &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L135"><span class="lineNum">     135</span> <span class="tlaGNC">        5760 :       tmp_cxp, tmp_cyp, tmp_cxm, tmp_cym,               &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L136"><span class="lineNum">     136</span> <span class="tlaGNC">        5760 :       tmp_strength, tmp_DminTarea, tmparea,             &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L137"><span class="lineNum">     137</span> <span class="tlaGNC">        5760 :       tmp_dxhy, tmp_dyhx</span></span>
<span id="L138"><span class="lineNum">     138</span>              : </span>
<span id="L139"><span class="lineNum">     139</span>              :     character(len=*), parameter :: subname = '(stress_1d)'</span>
<span id="L140"><span class="lineNum">     140</span>              : </span>
<span id="L141"><span class="lineNum">     141</span>              : #ifdef _OPENMP_TARGET</span>
<span id="L142"><span class="lineNum">     142</span>              :     !$omp target teams distribute parallel do</span>
<span id="L143"><span class="lineNum">     143</span>              : #else</span>
<span id="L144"><span class="lineNum">     144</span>              :     !$omp parallel do schedule(runtime)                        &amp;</span>
<span id="L145"><span class="lineNum">     145</span>              :     !$omp default(none)                                        &amp;   ! LCOV_EXCL_LINE</span>
<span id="L146"><span class="lineNum">     146</span>              :     !$omp private(iw, divune, divunw, divuse, divusw         , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L147"><span class="lineNum">     147</span>              :     !$omp         tensionne, tensionnw, tensionse, tensionsw , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L148"><span class="lineNum">     148</span>              :     !$omp         shearne, shearnw, shearse, shearsw         , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L149"><span class="lineNum">     149</span>              :     !$omp         Deltane, Deltanw, Deltase, Deltasw         , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L150"><span class="lineNum">     150</span>              :     !$omp         zetax2ne, zetax2nw, zetax2se, zetax2sw     , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L151"><span class="lineNum">     151</span>              :     !$omp         etax2ne, etax2nw, etax2se, etax2sw         , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L152"><span class="lineNum">     152</span>              :     !$omp         rep_prsne, rep_prsnw, rep_prsse, rep_prssw , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L153"><span class="lineNum">     153</span>              :     !$omp         ssigpn, ssigps, ssigpe, ssigpw             , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L154"><span class="lineNum">     154</span>              :     !$omp         ssigmn, ssigms, ssigme, ssigmw             , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L155"><span class="lineNum">     155</span>              :     !$omp         ssig12n, ssig12s, ssig12e, ssig12w, ssigp1 , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L156"><span class="lineNum">     156</span>              :     !$omp         ssigp2, ssigm1, ssigm2, ssig121, ssig122   , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L157"><span class="lineNum">     157</span>              :     !$omp         csigpne, csigpnw, csigpse, csigpsw         , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L158"><span class="lineNum">     158</span>              :     !$omp         csigmne, csigmnw, csigmse, csigmsw         , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L159"><span class="lineNum">     159</span>              :     !$omp         csig12ne, csig12nw, csig12se, csig12sw     , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L160"><span class="lineNum">     160</span>              :     !$omp         str12ew, str12we, str12ns, str12sn         , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L161"><span class="lineNum">     161</span>              :     !$omp         strp_tmp, strm_tmp                         , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L162"><span class="lineNum">     162</span>              :     !$omp         tmp_uvel_ee, tmp_vvel_se, tmp_vvel_ee      , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L163"><span class="lineNum">     163</span>              :     !$omp         tmp_vvel_ne, tmp_uvel_ne, tmp_uvel_se      , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L164"><span class="lineNum">     164</span>              :     !$omp         tmp_uvel_cc, tmp_vvel_cc, tmp_dxT, tmp_dyT , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L165"><span class="lineNum">     165</span>              :     !$omp         tmp_cxp, tmp_cyp, tmp_cxm, tmp_cym         , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L166"><span class="lineNum">     166</span>              :     !$omp         tmp_strength, tmp_DminTarea, tmparea       , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L167"><span class="lineNum">     167</span>              :     !$omp         tmp_dxhy, tmp_dyhx)                          &amp;   ! LCOV_EXCL_LINE</span>
<span id="L168"><span class="lineNum">     168</span>              :     !$omp  shared(uvel,vvel,dxT,dyT,htn,hte,htnm1,htem1      , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L169"><span class="lineNum">     169</span>              :     !$omp         str1,str2,str3,str4,str5,str6,str7,str8    , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L170"><span class="lineNum">     170</span>              :     !$omp         stressp_1,stressp_2,stressp_3,stressp_4    , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L171"><span class="lineNum">     171</span>              :     !$omp         stressm_1,stressm_2,stressm_3,stressm_4    , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L172"><span class="lineNum">     172</span>              :     !$omp         stress12_1,stress12_2,stress12_3,stress12_4, &amp;   ! LCOV_EXCL_LINE</span>
<span id="L173"><span class="lineNum">     173</span>              :     !$omp         deltaminEVP, arlx1i, denom1, e_factor      , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L174"><span class="lineNum">     174</span>              :     !$omp         epp2i, capping,                              &amp;   ! LCOV_EXCL_LINE</span>
<span id="L175"><span class="lineNum">     175</span> <span class="tlaGNC">      120960 :     !$omp         skipme,strength,ee,se,ne,lb,ub,revp)</span></span>
<span id="L176"><span class="lineNum">     176</span>              : #endif</span>
<span id="L177"><span class="lineNum">     177</span>              : </span>
<span id="L178"><span class="lineNum">     178</span> <span class="tlaUNC tlaBgUNC">           0 :     do iw = lb, ub</span></span>
<span id="L179"><span class="lineNum">     179</span> <span class="tlaUNC">           0 :       if (skipme(iw)) cycle</span></span>
<span id="L180"><span class="lineNum">     180</span>              :       ! divergence  =  e_11 + e_22</span>
<span id="L181"><span class="lineNum">     181</span> <span class="tlaUNC">           0 :       tmp_uvel_cc   = uvel(iw)</span></span>
<span id="L182"><span class="lineNum">     182</span> <span class="tlaUNC">           0 :       tmp_vvel_cc   = vvel(iw)</span></span>
<span id="L183"><span class="lineNum">     183</span> <span class="tlaUNC">           0 :       tmp_uvel_ee   = uvel(ee(iw))</span></span>
<span id="L184"><span class="lineNum">     184</span> <span class="tlaUNC">           0 :       tmp_vvel_se   = vvel(se(iw))</span></span>
<span id="L185"><span class="lineNum">     185</span> <span class="tlaUNC">           0 :       tmp_vvel_ee   = vvel(ee(iw))</span></span>
<span id="L186"><span class="lineNum">     186</span> <span class="tlaUNC">           0 :       tmp_vvel_ne   = vvel(ne(iw))</span></span>
<span id="L187"><span class="lineNum">     187</span> <span class="tlaUNC">           0 :       tmp_uvel_ne   = uvel(ne(iw))</span></span>
<span id="L188"><span class="lineNum">     188</span> <span class="tlaUNC">           0 :       tmp_uvel_se   = uvel(se(iw))</span></span>
<span id="L189"><span class="lineNum">     189</span> <span class="tlaUNC">           0 :       tmp_dxT       = dxT(iw)</span></span>
<span id="L190"><span class="lineNum">     190</span> <span class="tlaUNC">           0 :       tmp_dyT       = dyT(iw)</span></span>
<span id="L191"><span class="lineNum">     191</span> <span class="tlaUNC">           0 :       tmp_cxp       = c1p5 * htn(iw) - p5 * htnm1(iw)</span></span>
<span id="L192"><span class="lineNum">     192</span> <span class="tlaUNC">           0 :       tmp_cyp       = c1p5 * hte(iw) - p5 * htem1(iw)</span></span>
<span id="L193"><span class="lineNum">     193</span> <span class="tlaUNC">           0 :       tmp_cxm       = -(c1p5 * htnm1(iw) - p5 * htn(iw))</span></span>
<span id="L194"><span class="lineNum">     194</span> <span class="tlaUNC">           0 :       tmp_cym       = -(c1p5 * htem1(iw) - p5 * hte(iw))</span></span>
<span id="L195"><span class="lineNum">     195</span> <span class="tlaUNC">           0 :       tmp_strength  = strength(iw)</span></span>
<span id="L196"><span class="lineNum">     196</span> <span class="tlaUNC">           0 :       tmparea       = dxT(iw) * dyT(iw) ! necessary to split calc of DminTarea. Otherwize not binary identical</span></span>
<span id="L197"><span class="lineNum">     197</span> <span class="tlaUNC">           0 :       tmp_DminTarea = deltaminEVP * tmparea</span></span>
<span id="L198"><span class="lineNum">     198</span> <span class="tlaUNC">           0 :       tmp_dxhy      = p5 * (hte(iw) - htem1(iw))</span></span>
<span id="L199"><span class="lineNum">     199</span> <span class="tlaUNC">           0 :       tmp_dyhx      = p5 * (htn(iw) - htnm1(iw))</span></span>
<span id="L200"><span class="lineNum">     200</span>              : </span>
<span id="L201"><span class="lineNum">     201</span>              :       !--------------------------------------------------------------------------</span>
<span id="L202"><span class="lineNum">     202</span>              :       ! strain rates - NOTE these are actually strain rates * area  (m^2/s)</span>
<span id="L203"><span class="lineNum">     203</span>              :       !--------------------------------------------------------------------------</span>
<span id="L204"><span class="lineNum">     204</span>              :       call strain_rates_1d (tmp_uvel_cc, tmp_vvel_cc, &amp;</span>
<span id="L205"><span class="lineNum">     205</span>              :                             tmp_uvel_ee, tmp_vvel_ee, &amp;   ! LCOV_EXCL_LINE</span>
<span id="L206"><span class="lineNum">     206</span>              :                             tmp_uvel_se, tmp_vvel_se, &amp;   ! LCOV_EXCL_LINE</span>
<span id="L207"><span class="lineNum">     207</span>              :                             tmp_uvel_ne, tmp_vvel_ne, &amp;   ! LCOV_EXCL_LINE</span>
<span id="L208"><span class="lineNum">     208</span>              :                             tmp_dxT    , tmp_dyT    , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L209"><span class="lineNum">     209</span>              :                             tmp_cxp    , tmp_cyp    , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L210"><span class="lineNum">     210</span>              :                             tmp_cxm    , tmp_cym    , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L211"><span class="lineNum">     211</span>              :                             divune     , divunw     , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L212"><span class="lineNum">     212</span>              :                             divuse     , divusw     , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L213"><span class="lineNum">     213</span>              :                             tensionne  , tensionnw  , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L214"><span class="lineNum">     214</span>              :                             tensionse  , tensionsw  , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L215"><span class="lineNum">     215</span>              :                             shearne    , shearnw    , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L216"><span class="lineNum">     216</span>              :                             shearse,    shearsw     , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L217"><span class="lineNum">     217</span>              :                             Deltane,    Deltanw     , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L218"><span class="lineNum">     218</span> <span class="tlaUNC">           0 :                             Deltase,    Deltasw )</span></span>
<span id="L219"><span class="lineNum">     219</span>              : </span>
<span id="L220"><span class="lineNum">     220</span>              :       !--------------------------------------------------------------------------</span>
<span id="L221"><span class="lineNum">     221</span>              :       ! viscosities and replacement pressure</span>
<span id="L222"><span class="lineNum">     222</span>              :       !--------------------------------------------------------------------------</span>
<span id="L223"><span class="lineNum">     223</span>              :       call visc_replpress (tmp_strength, tmp_DminTarea, Deltane, &amp;</span>
<span id="L224"><span class="lineNum">     224</span> <span class="tlaUNC">           0 :                            zetax2ne, etax2ne, rep_prsne)</span></span>
<span id="L225"><span class="lineNum">     225</span>              : </span>
<span id="L226"><span class="lineNum">     226</span>              :       call visc_replpress (tmp_strength, tmp_DminTarea, Deltanw, &amp;</span>
<span id="L227"><span class="lineNum">     227</span> <span class="tlaUNC">           0 :                            zetax2nw, etax2nw, rep_prsnw)</span></span>
<span id="L228"><span class="lineNum">     228</span>              : </span>
<span id="L229"><span class="lineNum">     229</span>              :       call visc_replpress (tmp_strength, tmp_DminTarea, Deltasw, &amp;</span>
<span id="L230"><span class="lineNum">     230</span> <span class="tlaUNC">           0 :                            zetax2sw, etax2sw, rep_prssw)</span></span>
<span id="L231"><span class="lineNum">     231</span>              : </span>
<span id="L232"><span class="lineNum">     232</span>              :       call visc_replpress (tmp_strength, tmp_DminTarea, Deltase, &amp;</span>
<span id="L233"><span class="lineNum">     233</span> <span class="tlaUNC">           0 :                            zetax2se, etax2se, rep_prsse)</span></span>
<span id="L234"><span class="lineNum">     234</span>              : </span>
<span id="L235"><span class="lineNum">     235</span>              :       !--------------------------------------------------------------------------</span>
<span id="L236"><span class="lineNum">     236</span>              :       ! the stresses                            ! kg/s^2</span>
<span id="L237"><span class="lineNum">     237</span>              :       ! (1) northeast, (2) northwest, (3) southwest, (4) southeast</span>
<span id="L238"><span class="lineNum">     238</span>              :       !--------------------------------------------------------------------------</span>
<span id="L239"><span class="lineNum">     239</span>              :       ! NOTE: for comp. efficiency 2 x zeta and 2 x eta are used in the code</span>
<span id="L240"><span class="lineNum">     240</span>              : </span>
<span id="L241"><span class="lineNum">     241</span> <span class="tlaUNC">           0 :       stressp_1 (iw) = (stressp_1 (iw)*(c1-arlx1i*revp) &amp;</span></span>
<span id="L242"><span class="lineNum">     242</span> <span class="tlaUNC">           0 :                      +  arlx1i*(zetax2ne*divune - rep_prsne)) * denom1</span></span>
<span id="L243"><span class="lineNum">     243</span> <span class="tlaUNC">           0 :       stressp_2 (iw) = (stressp_2 (iw)*(c1-arlx1i*revp) &amp;</span></span>
<span id="L244"><span class="lineNum">     244</span> <span class="tlaUNC">           0 :                      +  arlx1i*(zetax2nw*divunw - rep_prsnw)) * denom1</span></span>
<span id="L245"><span class="lineNum">     245</span> <span class="tlaUNC">           0 :       stressp_3 (iw) = (stressp_3 (iw)*(c1-arlx1i*revp)&amp;</span></span>
<span id="L246"><span class="lineNum">     246</span> <span class="tlaUNC">           0 :                      +  arlx1i*(zetax2sw*divusw - rep_prssw)) * denom1</span></span>
<span id="L247"><span class="lineNum">     247</span> <span class="tlaUNC">           0 :       stressp_4 (iw) = (stressp_4 (iw)*(c1-arlx1i*revp) &amp;</span></span>
<span id="L248"><span class="lineNum">     248</span> <span class="tlaUNC">           0 :                      +  arlx1i*(zetax2se*divuse - rep_prsse)) * denom1</span></span>
<span id="L249"><span class="lineNum">     249</span>              : </span>
<span id="L250"><span class="lineNum">     250</span> <span class="tlaUNC">           0 :       stressm_1 (iw) = (stressm_1 (iw)*(c1-arlx1i*revp) &amp;</span></span>
<span id="L251"><span class="lineNum">     251</span> <span class="tlaUNC">           0 :                      +  arlx1i*etax2ne*tensionne) * denom1</span></span>
<span id="L252"><span class="lineNum">     252</span> <span class="tlaUNC">           0 :       stressm_2 (iw) = (stressm_2 (iw)*(c1-arlx1i*revp) &amp;</span></span>
<span id="L253"><span class="lineNum">     253</span> <span class="tlaUNC">           0 :                    +  arlx1i*etax2nw*tensionnw) * denom1</span></span>
<span id="L254"><span class="lineNum">     254</span> <span class="tlaUNC">           0 :       stressm_3 (iw) = (stressm_3 (iw)*(c1-arlx1i*revp) &amp;</span></span>
<span id="L255"><span class="lineNum">     255</span> <span class="tlaUNC">           0 :                      +  arlx1i*etax2sw*tensionsw) * denom1</span></span>
<span id="L256"><span class="lineNum">     256</span> <span class="tlaUNC">           0 :       stressm_4 (iw) = (stressm_4 (iw)*(c1-arlx1i*revp) &amp;</span></span>
<span id="L257"><span class="lineNum">     257</span> <span class="tlaUNC">           0 :                      +  arlx1i*etax2se*tensionse) * denom1</span></span>
<span id="L258"><span class="lineNum">     258</span>              : </span>
<span id="L259"><span class="lineNum">     259</span> <span class="tlaUNC">           0 :       stress12_1(iw) = (stress12_1(iw)*(c1-arlx1i*revp) &amp;</span></span>
<span id="L260"><span class="lineNum">     260</span> <span class="tlaUNC">           0 :                      +  arlx1i*p5*etax2ne*shearne) * denom1</span></span>
<span id="L261"><span class="lineNum">     261</span> <span class="tlaUNC">           0 :       stress12_2(iw) = (stress12_2(iw)*(c1-arlx1i*revp) &amp;</span></span>
<span id="L262"><span class="lineNum">     262</span> <span class="tlaUNC">           0 :                      +  arlx1i*p5*etax2nw*shearnw) * denom1</span></span>
<span id="L263"><span class="lineNum">     263</span> <span class="tlaUNC">           0 :       stress12_3(iw) = (stress12_3(iw)*(c1-arlx1i*revp) &amp;</span></span>
<span id="L264"><span class="lineNum">     264</span> <span class="tlaUNC">           0 :                      +  arlx1i*p5*etax2sw*shearsw) * denom1</span></span>
<span id="L265"><span class="lineNum">     265</span> <span class="tlaUNC">           0 :       stress12_4(iw) = (stress12_4(iw)*(c1-arlx1i*revp) &amp;</span></span>
<span id="L266"><span class="lineNum">     266</span> <span class="tlaUNC">           0 :                      +  arlx1i*p5*etax2se*shearse) * denom1</span></span>
<span id="L267"><span class="lineNum">     267</span>              : </span>
<span id="L268"><span class="lineNum">     268</span>              :       !--------------------------------------------------------------------------</span>
<span id="L269"><span class="lineNum">     269</span>              :       ! combinations of the stresses for the momentum equation ! kg/s^2</span>
<span id="L270"><span class="lineNum">     270</span>              :       !--------------------------------------------------------------------------</span>
<span id="L271"><span class="lineNum">     271</span> <span class="tlaUNC">           0 :       ssigpn  = stressp_1(iw) + stressp_2(iw)</span></span>
<span id="L272"><span class="lineNum">     272</span> <span class="tlaUNC">           0 :       ssigps  = stressp_3(iw) + stressp_4(iw)</span></span>
<span id="L273"><span class="lineNum">     273</span> <span class="tlaUNC">           0 :       ssigpe  = stressp_1(iw) + stressp_4(iw)</span></span>
<span id="L274"><span class="lineNum">     274</span> <span class="tlaUNC">           0 :       ssigpw  = stressp_2(iw) + stressp_3(iw)</span></span>
<span id="L275"><span class="lineNum">     275</span> <span class="tlaUNC">           0 :       ssigp1  =(stressp_1(iw) + stressp_3(iw))*p055</span></span>
<span id="L276"><span class="lineNum">     276</span> <span class="tlaUNC">           0 :       ssigp2  =(stressp_2(iw) + stressp_4(iw))*p055</span></span>
<span id="L277"><span class="lineNum">     277</span>              : </span>
<span id="L278"><span class="lineNum">     278</span> <span class="tlaUNC">           0 :       ssigmn  = stressm_1(iw) + stressm_2(iw)</span></span>
<span id="L279"><span class="lineNum">     279</span> <span class="tlaUNC">           0 :       ssigms  = stressm_3(iw) + stressm_4(iw)</span></span>
<span id="L280"><span class="lineNum">     280</span> <span class="tlaUNC">           0 :       ssigme  = stressm_1(iw) + stressm_4(iw)</span></span>
<span id="L281"><span class="lineNum">     281</span> <span class="tlaUNC">           0 :       ssigmw  = stressm_2(iw) + stressm_3(iw)</span></span>
<span id="L282"><span class="lineNum">     282</span> <span class="tlaUNC">           0 :       ssigm1  =(stressm_1(iw) + stressm_3(iw))*p055</span></span>
<span id="L283"><span class="lineNum">     283</span> <span class="tlaUNC">           0 :       ssigm2  =(stressm_2(iw) + stressm_4(iw))*p055</span></span>
<span id="L284"><span class="lineNum">     284</span>              : </span>
<span id="L285"><span class="lineNum">     285</span> <span class="tlaUNC">           0 :       ssig12n = stress12_1(iw) + stress12_2(iw)</span></span>
<span id="L286"><span class="lineNum">     286</span> <span class="tlaUNC">           0 :       ssig12s = stress12_3(iw) + stress12_4(iw)</span></span>
<span id="L287"><span class="lineNum">     287</span> <span class="tlaUNC">           0 :       ssig12e = stress12_1(iw) + stress12_4(iw)</span></span>
<span id="L288"><span class="lineNum">     288</span> <span class="tlaUNC">           0 :       ssig12w = stress12_2(iw) + stress12_3(iw)</span></span>
<span id="L289"><span class="lineNum">     289</span> <span class="tlaUNC">           0 :       ssig121 =(stress12_1(iw) + stress12_3(iw))*p111</span></span>
<span id="L290"><span class="lineNum">     290</span> <span class="tlaUNC">           0 :       ssig122 =(stress12_2(iw) + stress12_4(iw))*p111</span></span>
<span id="L291"><span class="lineNum">     291</span>              : </span>
<span id="L292"><span class="lineNum">     292</span> <span class="tlaUNC">           0 :       csigpne = p111*stressp_1(iw) + ssigp2 + p027*stressp_3(iw)</span></span>
<span id="L293"><span class="lineNum">     293</span> <span class="tlaUNC">           0 :       csigpnw = p111*stressp_2(iw) + ssigp1 + p027*stressp_4(iw)</span></span>
<span id="L294"><span class="lineNum">     294</span> <span class="tlaUNC">           0 :       csigpsw = p111*stressp_3(iw) + ssigp2 + p027*stressp_1(iw)</span></span>
<span id="L295"><span class="lineNum">     295</span> <span class="tlaUNC">           0 :       csigpse = p111*stressp_4(iw) + ssigp1 + p027*stressp_2(iw)</span></span>
<span id="L296"><span class="lineNum">     296</span>              : </span>
<span id="L297"><span class="lineNum">     297</span> <span class="tlaUNC">           0 :       csigmne = p111*stressm_1(iw) + ssigm2 + p027*stressm_3(iw)</span></span>
<span id="L298"><span class="lineNum">     298</span> <span class="tlaUNC">           0 :       csigmnw = p111*stressm_2(iw) + ssigm1 + p027*stressm_4(iw)</span></span>
<span id="L299"><span class="lineNum">     299</span> <span class="tlaUNC">           0 :       csigmsw = p111*stressm_3(iw) + ssigm2 + p027*stressm_1(iw)</span></span>
<span id="L300"><span class="lineNum">     300</span> <span class="tlaUNC">           0 :       csigmse = p111*stressm_4(iw) + ssigm1 + p027*stressm_2(iw)</span></span>
<span id="L301"><span class="lineNum">     301</span>              : </span>
<span id="L302"><span class="lineNum">     302</span> <span class="tlaUNC">           0 :       csig12ne = p222*stress12_1(iw) + ssig122 &amp;</span></span>
<span id="L303"><span class="lineNum">     303</span> <span class="tlaUNC">           0 :                + p055*stress12_3(iw)</span></span>
<span id="L304"><span class="lineNum">     304</span> <span class="tlaUNC">           0 :       csig12nw = p222*stress12_2(iw) + ssig121 &amp;</span></span>
<span id="L305"><span class="lineNum">     305</span> <span class="tlaUNC">           0 :                + p055*stress12_4(iw)</span></span>
<span id="L306"><span class="lineNum">     306</span> <span class="tlaUNC">           0 :       csig12sw = p222*stress12_3(iw) + ssig122 &amp;</span></span>
<span id="L307"><span class="lineNum">     307</span> <span class="tlaUNC">           0 :                + p055*stress12_1(iw)</span></span>
<span id="L308"><span class="lineNum">     308</span> <span class="tlaUNC">           0 :       csig12se = p222*stress12_4(iw) + ssig121 &amp;</span></span>
<span id="L309"><span class="lineNum">     309</span> <span class="tlaUNC">           0 :                + p055*stress12_2(iw)</span></span>
<span id="L310"><span class="lineNum">     310</span>              : </span>
<span id="L311"><span class="lineNum">     311</span> <span class="tlaUNC">           0 :       str12ew = p5*tmp_dxt*(p333*ssig12e + p166*ssig12w)</span></span>
<span id="L312"><span class="lineNum">     312</span> <span class="tlaUNC">           0 :       str12we = p5*tmp_dxt*(p333*ssig12w + p166*ssig12e)</span></span>
<span id="L313"><span class="lineNum">     313</span> <span class="tlaUNC">           0 :       str12ns = p5*tmp_dyt*(p333*ssig12n + p166*ssig12s)</span></span>
<span id="L314"><span class="lineNum">     314</span> <span class="tlaUNC">           0 :       str12sn = p5*tmp_dyt*(p333*ssig12s + p166*ssig12n)</span></span>
<span id="L315"><span class="lineNum">     315</span>              : </span>
<span id="L316"><span class="lineNum">     316</span>              :       !--------------------------------------------------------------------------</span>
<span id="L317"><span class="lineNum">     317</span>              :       ! for dF/dx (u momentum)</span>
<span id="L318"><span class="lineNum">     318</span>              :       !--------------------------------------------------------------------------</span>
<span id="L319"><span class="lineNum">     319</span> <span class="tlaUNC">           0 :       strp_tmp  = p25*tmp_dyT*(p333*ssigpn  + p166*ssigps)</span></span>
<span id="L320"><span class="lineNum">     320</span> <span class="tlaUNC">           0 :       strm_tmp  = p25*tmp_dyT*(p333*ssigmn  + p166*ssigms)</span></span>
<span id="L321"><span class="lineNum">     321</span>              : </span>
<span id="L322"><span class="lineNum">     322</span>              :       ! northeast (i,j)</span>
<span id="L323"><span class="lineNum">     323</span> <span class="tlaUNC">           0 :       str1(iw) = -strp_tmp - strm_tmp - str12ew &amp;</span></span>
<span id="L324"><span class="lineNum">     324</span> <span class="tlaUNC">           0 :                  +tmp_dxhy*(-csigpne + csigmne) + tmp_dyhx*csig12ne</span></span>
<span id="L325"><span class="lineNum">     325</span>              : </span>
<span id="L326"><span class="lineNum">     326</span>              :       ! northwest (i+1,j)</span>
<span id="L327"><span class="lineNum">     327</span> <span class="tlaUNC">           0 :       str2(iw) = strp_tmp + strm_tmp - str12we &amp;</span></span>
<span id="L328"><span class="lineNum">     328</span> <span class="tlaUNC">           0 :                  +tmp_dxhy*(-csigpnw + csigmnw) + tmp_dyhx*csig12nw</span></span>
<span id="L329"><span class="lineNum">     329</span>              : </span>
<span id="L330"><span class="lineNum">     330</span> <span class="tlaUNC">           0 :       strp_tmp  = p25*tmp_dyT*(p333*ssigps  + p166*ssigpn)</span></span>
<span id="L331"><span class="lineNum">     331</span> <span class="tlaUNC">           0 :       strm_tmp  = p25*tmp_dyT*(p333*ssigms  + p166*ssigmn)</span></span>
<span id="L332"><span class="lineNum">     332</span>              : </span>
<span id="L333"><span class="lineNum">     333</span>              :       ! southeast (i,j+1)</span>
<span id="L334"><span class="lineNum">     334</span> <span class="tlaUNC">           0 :       str3(iw) = -strp_tmp - strm_tmp + str12ew &amp;</span></span>
<span id="L335"><span class="lineNum">     335</span> <span class="tlaUNC">           0 :                  +tmp_dxhy*(-csigpse + csigmse) + tmp_dyhx*csig12se</span></span>
<span id="L336"><span class="lineNum">     336</span>              : </span>
<span id="L337"><span class="lineNum">     337</span>              :       ! southwest (i+1,j+1)</span>
<span id="L338"><span class="lineNum">     338</span> <span class="tlaUNC">           0 :       str4(iw) = strp_tmp + strm_tmp + str12we &amp;</span></span>
<span id="L339"><span class="lineNum">     339</span> <span class="tlaUNC">           0 :                  +tmp_dxhy*(-csigpsw + csigmsw) + tmp_dyhx*csig12sw</span></span>
<span id="L340"><span class="lineNum">     340</span>              : </span>
<span id="L341"><span class="lineNum">     341</span>              :       !--------------------------------------------------------------------------</span>
<span id="L342"><span class="lineNum">     342</span>              :       ! for dF/dy (v momentum)</span>
<span id="L343"><span class="lineNum">     343</span>              :       !--------------------------------------------------------------------------</span>
<span id="L344"><span class="lineNum">     344</span> <span class="tlaUNC">           0 :       strp_tmp  = p25*tmp_dxT*(p333*ssigpe  + p166*ssigpw)</span></span>
<span id="L345"><span class="lineNum">     345</span> <span class="tlaUNC">           0 :       strm_tmp  = p25*tmp_dxT*(p333*ssigme  + p166*ssigmw)</span></span>
<span id="L346"><span class="lineNum">     346</span>              : </span>
<span id="L347"><span class="lineNum">     347</span>              :       ! northeast (i,j)</span>
<span id="L348"><span class="lineNum">     348</span> <span class="tlaUNC">           0 :       str5(iw) = -strp_tmp + strm_tmp - str12ns &amp;</span></span>
<span id="L349"><span class="lineNum">     349</span> <span class="tlaUNC">           0 :                  -tmp_dyhx*(csigpne + csigmne) + tmp_dxhy*csig12ne</span></span>
<span id="L350"><span class="lineNum">     350</span>              : </span>
<span id="L351"><span class="lineNum">     351</span>              :       ! southeast (i,j+1)</span>
<span id="L352"><span class="lineNum">     352</span> <span class="tlaUNC">           0 :       str6(iw) =  strp_tmp - strm_tmp - str12sn &amp;</span></span>
<span id="L353"><span class="lineNum">     353</span> <span class="tlaUNC">           0 :                  -tmp_dyhx*(csigpse + csigmse) + tmp_dxhy*csig12se</span></span>
<span id="L354"><span class="lineNum">     354</span>              : </span>
<span id="L355"><span class="lineNum">     355</span> <span class="tlaUNC">           0 :       strp_tmp  = p25*tmp_dxT*(p333*ssigpw  + p166*ssigpe)</span></span>
<span id="L356"><span class="lineNum">     356</span> <span class="tlaUNC">           0 :       strm_tmp  = p25*tmp_dxT*(p333*ssigmw  + p166*ssigme)</span></span>
<span id="L357"><span class="lineNum">     357</span>              : </span>
<span id="L358"><span class="lineNum">     358</span>              :        ! northwest (i+1,j)</span>
<span id="L359"><span class="lineNum">     359</span> <span class="tlaUNC">           0 :       str7(iw) = -strp_tmp + strm_tmp + str12ns &amp;</span></span>
<span id="L360"><span class="lineNum">     360</span> <span class="tlaUNC">           0 :                  -tmp_dyhx*(csigpnw + csigmnw) + tmp_dxhy*csig12nw</span></span>
<span id="L361"><span class="lineNum">     361</span>              : </span>
<span id="L362"><span class="lineNum">     362</span>              :       ! southwest (i+1,j+1)</span>
<span id="L363"><span class="lineNum">     363</span> <span class="tlaUNC">           0 :       str8(iw) =  strp_tmp - strm_tmp + str12sn &amp;</span></span>
<span id="L364"><span class="lineNum">     364</span> <span class="tlaUNC">           0 :                  -tmp_dyhx*(csigpsw + csigmsw) + tmp_dxhy*csig12sw</span></span>
<span id="L365"><span class="lineNum">     365</span>              :     enddo</span>
<span id="L366"><span class="lineNum">     366</span>              : #ifdef _OPENMP_TARGET</span>
<span id="L367"><span class="lineNum">     367</span>              :     !$omp end target teams distribute parallel do</span>
<span id="L368"><span class="lineNum">     368</span>              : #else</span>
<span id="L369"><span class="lineNum">     369</span>              :     !$omp end parallel do</span>
<span id="L370"><span class="lineNum">     370</span>              : #endif</span>
<span id="L371"><span class="lineNum">     371</span> <span class="tlaGNC tlaBgGNC">      120960 :   end subroutine stress_1d</span></span>
<span id="L372"><span class="lineNum">     372</span>              : </span>
<span id="L373"><span class="lineNum">     373</span>              :   !=============================================================================</span>
<span id="L374"><span class="lineNum">     374</span>              :   ! Compute strain rates</span>
<span id="L375"><span class="lineNum">     375</span>              :   !</span>
<span id="L376"><span class="lineNum">     376</span>              :   ! author: Elizabeth C. Hunke, LANL</span>
<span id="L377"><span class="lineNum">     377</span>              :   !</span>
<span id="L378"><span class="lineNum">     378</span>              :   ! 2019: subroutine created by Philippe Blain, ECCC</span>
<span id="L379"><span class="lineNum">     379</span> <span class="tlaGNC">   243613200 :   subroutine strain_rates_1d (tmp_uvel_cc, tmp_vvel_cc, &amp;</span></span>
<span id="L380"><span class="lineNum">     380</span>              :                               tmp_uvel_ee, tmp_vvel_ee, &amp;   ! LCOV_EXCL_LINE</span>
<span id="L381"><span class="lineNum">     381</span>              :                               tmp_uvel_se, tmp_vvel_se, &amp;   ! LCOV_EXCL_LINE</span>
<span id="L382"><span class="lineNum">     382</span>              :                               tmp_uvel_ne, tmp_vvel_ne, &amp;   ! LCOV_EXCL_LINE</span>
<span id="L383"><span class="lineNum">     383</span>              :                               dxT        , dyT        , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L384"><span class="lineNum">     384</span>              :                               cxp        , cyp        , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L385"><span class="lineNum">     385</span>              :                               cxm        , cym        , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L386"><span class="lineNum">     386</span>              :                               divune     , divunw     , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L387"><span class="lineNum">     387</span>              :                               divuse     , divusw     , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L388"><span class="lineNum">     388</span>              :                               tensionne  , tensionnw  , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L389"><span class="lineNum">     389</span>              :                               tensionse  , tensionsw  , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L390"><span class="lineNum">     390</span>              :                               shearne    , shearnw    , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L391"><span class="lineNum">     391</span>              :                               shearse    , shearsw    , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L392"><span class="lineNum">     392</span>              :                               Deltane    , Deltanw    , &amp;   ! LCOV_EXCL_LINE</span>
<span id="L393"><span class="lineNum">     393</span>              :                               Deltase    , Deltasw )</span>
<span id="L394"><span class="lineNum">     394</span>              : </span>
<span id="L395"><span class="lineNum">     395</span>              :     use ice_kinds_mod</span>
<span id="L396"><span class="lineNum">     396</span>              : </span>
<span id="L397"><span class="lineNum">     397</span>              :     real (kind=dbl_kind), intent(in) ::                    &amp;</span>
<span id="L398"><span class="lineNum">     398</span>              :        tmp_uvel_ee, tmp_vvel_ee, tmp_uvel_se, tmp_vvel_se, &amp;   ! LCOV_EXCL_LINE</span>
<span id="L399"><span class="lineNum">     399</span>              :        tmp_uvel_cc, tmp_vvel_cc, tmp_uvel_ne, tmp_vvel_ne</span>
<span id="L400"><span class="lineNum">     400</span>              : </span>
<span id="L401"><span class="lineNum">     401</span>              :     real (kind=dbl_kind), intent(in) :: &amp;</span>
<span id="L402"><span class="lineNum">     402</span>              :        dxT      ,                       &amp; ! width of T-cell through the middle (m)   ! LCOV_EXCL_LINE</span>
<span id="L403"><span class="lineNum">     403</span>              :        dyT      ,                       &amp; ! height of T-cell through the middle (m)   ! LCOV_EXCL_LINE</span>
<span id="L404"><span class="lineNum">     404</span>              :        cyp      ,                       &amp; ! 1.5*HTE - 0.5*HTW   ! LCOV_EXCL_LINE</span>
<span id="L405"><span class="lineNum">     405</span>              :        cxp      ,                       &amp; ! 1.5*HTN - 0.5*HTS   ! LCOV_EXCL_LINE</span>
<span id="L406"><span class="lineNum">     406</span>              :        cym      ,                       &amp; ! 0.5*HTE - 1.5*HTW   ! LCOV_EXCL_LINE</span>
<span id="L407"><span class="lineNum">     407</span>              :        cxm                                ! 0.5*HTN - 1.5*HTS</span>
<span id="L408"><span class="lineNum">     408</span>              : </span>
<span id="L409"><span class="lineNum">     409</span>              :     real (kind=dbl_kind), intent(out)::            &amp; ! at each corner :</span>
<span id="L410"><span class="lineNum">     410</span>              :        divune, divunw, divuse, divusw            , &amp; ! divergence   ! LCOV_EXCL_LINE</span>
<span id="L411"><span class="lineNum">     411</span>              :        tensionne, tensionnw, tensionse, tensionsw, &amp; ! tension   ! LCOV_EXCL_LINE</span>
<span id="L412"><span class="lineNum">     412</span>              :        shearne, shearnw, shearse, shearsw        , &amp; ! shearing   ! LCOV_EXCL_LINE</span>
<span id="L413"><span class="lineNum">     413</span>              :        Deltane, Deltanw, Deltase, Deltasw            ! Delta</span>
<span id="L414"><span class="lineNum">     414</span>              : </span>
<span id="L415"><span class="lineNum">     415</span>              :     character(len=*), parameter :: subname = '(strain_rates_1d)'</span>
<span id="L416"><span class="lineNum">     416</span>              : </span>
<span id="L417"><span class="lineNum">     417</span>              :     !-----------------------------------------------------------------------------</span>
<span id="L418"><span class="lineNum">     418</span>              :     ! strain rates</span>
<span id="L419"><span class="lineNum">     419</span>              :     ! NOTE these are actually strain rates * area  (m^2/s)</span>
<span id="L420"><span class="lineNum">     420</span>              :     !-----------------------------------------------------------------------------</span>
<span id="L421"><span class="lineNum">     421</span>              : </span>
<span id="L422"><span class="lineNum">     422</span>              :     ! divergence  =  e_11 + e_22</span>
<span id="L423"><span class="lineNum">     423</span>              :     divune    = cyp*tmp_uvel_cc - dyT*tmp_uvel_ee &amp;</span>
<span id="L424"><span class="lineNum">     424</span> <span class="tlaGNC">   243613200 :               + cxp*tmp_vvel_cc - dxT*tmp_vvel_se</span></span>
<span id="L425"><span class="lineNum">     425</span>              : </span>
<span id="L426"><span class="lineNum">     426</span>              :     divunw    = cym*tmp_uvel_ee + dyT*tmp_uvel_cc &amp;</span>
<span id="L427"><span class="lineNum">     427</span> <span class="tlaGNC">   243613200 :               + cxp*tmp_vvel_ee - dxT*tmp_vvel_ne</span></span>
<span id="L428"><span class="lineNum">     428</span>              : </span>
<span id="L429"><span class="lineNum">     429</span>              :     divusw    = cym*tmp_uvel_ne + dyT*tmp_uvel_se &amp;</span>
<span id="L430"><span class="lineNum">     430</span> <span class="tlaGNC">   243613200 :               + cxm*tmp_vvel_ne + dxT*tmp_vvel_ee</span></span>
<span id="L431"><span class="lineNum">     431</span>              : </span>
<span id="L432"><span class="lineNum">     432</span>              :     divuse    = cyp*tmp_uvel_se - dyT*tmp_uvel_ne &amp;</span>
<span id="L433"><span class="lineNum">     433</span> <span class="tlaGNC">   243613200 :               + cxm*tmp_vvel_se + dxT*tmp_vvel_cc</span></span>
<span id="L434"><span class="lineNum">     434</span>              : </span>
<span id="L435"><span class="lineNum">     435</span>              :     ! tension strain rate  =  e_11 - e_22</span>
<span id="L436"><span class="lineNum">     436</span>              :     tensionne = -cym*tmp_uvel_cc - dyT*tmp_uvel_ee &amp;</span>
<span id="L437"><span class="lineNum">     437</span> <span class="tlaGNC">   243613200 :                 +cxm*tmp_vvel_cc + dxT*tmp_vvel_se</span></span>
<span id="L438"><span class="lineNum">     438</span>              : </span>
<span id="L439"><span class="lineNum">     439</span>              :     tensionnw = -cyp*tmp_uvel_ee + dyT*tmp_uvel_cc&amp;</span>
<span id="L440"><span class="lineNum">     440</span> <span class="tlaGNC">   243613200 :                 +cxm*tmp_vvel_ee + dxT*tmp_vvel_ne</span></span>
<span id="L441"><span class="lineNum">     441</span>              : </span>
<span id="L442"><span class="lineNum">     442</span>              :     tensionsw = -cyp*tmp_uvel_ne + dyT*tmp_uvel_se &amp;</span>
<span id="L443"><span class="lineNum">     443</span> <span class="tlaGNC">   243613200 :                 +cxp*tmp_vvel_ne - dxT*tmp_vvel_ee</span></span>
<span id="L444"><span class="lineNum">     444</span>              : </span>
<span id="L445"><span class="lineNum">     445</span>              :     tensionse = -cym*tmp_uvel_se - dyT*tmp_uvel_ne &amp;</span>
<span id="L446"><span class="lineNum">     446</span> <span class="tlaGNC">   243613200 :                 +cxp*tmp_vvel_se - dxT*tmp_vvel_cc</span></span>
<span id="L447"><span class="lineNum">     447</span>              : </span>
<span id="L448"><span class="lineNum">     448</span>              :     ! shearing strain rate  =  2*e_12</span>
<span id="L449"><span class="lineNum">     449</span>              :     shearne   = -cym*tmp_vvel_cc - dyT*tmp_vvel_ee &amp;</span>
<span id="L450"><span class="lineNum">     450</span> <span class="tlaGNC">   243613200 :                 -cxm*tmp_uvel_cc - dxT*tmp_uvel_se</span></span>
<span id="L451"><span class="lineNum">     451</span>              : </span>
<span id="L452"><span class="lineNum">     452</span>              :     shearnw   = -cyp*tmp_vvel_ee + dyT*tmp_vvel_cc &amp;</span>
<span id="L453"><span class="lineNum">     453</span> <span class="tlaGNC">   243613200 :                 -cxm*tmp_uvel_ee - dxT*tmp_uvel_ne</span></span>
<span id="L454"><span class="lineNum">     454</span>              : </span>
<span id="L455"><span class="lineNum">     455</span>              :     shearsw   = -cyp*tmp_vvel_ne + dyT*tmp_vvel_se &amp;</span>
<span id="L456"><span class="lineNum">     456</span> <span class="tlaGNC">   243613200 :                 -cxp*tmp_uvel_ne + dxT*tmp_uvel_ee</span></span>
<span id="L457"><span class="lineNum">     457</span>              : </span>
<span id="L458"><span class="lineNum">     458</span>              :     shearse   = -cym*tmp_vvel_se - dyT*tmp_vvel_ne &amp;</span>
<span id="L459"><span class="lineNum">     459</span> <span class="tlaGNC">   243613200 :                 -cxp*tmp_uvel_se + dxT*tmp_uvel_cc</span></span>
<span id="L460"><span class="lineNum">     460</span>              : </span>
<span id="L461"><span class="lineNum">     461</span>              :     ! Delta (in the denominator of zeta, eta)</span>
<span id="L462"><span class="lineNum">     462</span> <span class="tlaGNC">   243613200 :     Deltane   = sqrt(divune**2 + e_factor*(tensionne**2 + shearne**2))</span></span>
<span id="L463"><span class="lineNum">     463</span> <span class="tlaGNC">   243613200 :     Deltanw   = sqrt(divunw**2 + e_factor*(tensionnw**2 + shearnw**2))</span></span>
<span id="L464"><span class="lineNum">     464</span> <span class="tlaGNC">   243613200 :     Deltasw   = sqrt(divusw**2 + e_factor*(tensionsw**2 + shearsw**2))</span></span>
<span id="L465"><span class="lineNum">     465</span> <span class="tlaGNC">   243613200 :     Deltase   = sqrt(divuse**2 + e_factor*(tensionse**2 + shearse**2))</span></span>
<span id="L466"><span class="lineNum">     466</span>              : </span>
<span id="L467"><span class="lineNum">     467</span> <span class="tlaGNC">   243613200 :   end subroutine strain_rates_1d</span></span>
<span id="L468"><span class="lineNum">     468</span>              : </span>
<span id="L469"><span class="lineNum">     469</span>              :   !=============================================================================</span>
<span id="L470"><span class="lineNum">     470</span>              :   ! Calculation of the surface stresses</span>
<span id="L471"><span class="lineNum">     471</span>              :   ! Integration of the momentum equation to find velocity (u,v)</span>
<span id="L472"><span class="lineNum">     472</span>              :   ! author: Elizabeth C. Hunke, LANL</span>
<span id="L473"><span class="lineNum">     473</span> <span class="tlaGNC">      120960 :   subroutine stepu_1d (lb       , ub       , &amp;</span></span>
<span id="L474"><span class="lineNum">     474</span> <span class="tlaGNC">      120960 :                        Cw       , aiX      , &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L475"><span class="lineNum">     475</span> <span class="tlaGNC">      120960 :                        uocn     , vocn     , &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L476"><span class="lineNum">     476</span> <span class="tlaGNC">      120960 :                        waterx   , watery   , &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L477"><span class="lineNum">     477</span> <span class="tlaGNC">      120960 :                        forcex   , forcey   , &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L478"><span class="lineNum">     478</span> <span class="tlaGNC">      120960 :                        umassdti , fm       , &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L479"><span class="lineNum">     479</span> <span class="tlaGNC">      120960 :                        uarear   ,            &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L480"><span class="lineNum">     480</span> <span class="tlaGNC">      120960 :                        uvel_init, vvel_init, &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L481"><span class="lineNum">     481</span> <span class="tlaGNC">      120960 :                        uvel     , vvel     , &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L482"><span class="lineNum">     482</span> <span class="tlaGNC">      120960 :                        str1     , str2     , &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L483"><span class="lineNum">     483</span> <span class="tlaGNC">      120960 :                        str3     , str4     , &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L484"><span class="lineNum">     484</span> <span class="tlaGNC">      120960 :                        str5     , str6     , &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L485"><span class="lineNum">     485</span> <span class="tlaGNC">      120960 :                        str7     , str8     , &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L486"><span class="lineNum">     486</span> <span class="tlaGNC">      120960 :                        nw       , sw       , &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L487"><span class="lineNum">     487</span> <span class="tlaGNC">      120960 :                        sse      , skipme   , &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L488"><span class="lineNum">     488</span> <span class="tlaGNC">      120960 :                        Tbu, Cb, rhow)</span></span>
<span id="L489"><span class="lineNum">     489</span>              : </span>
<span id="L490"><span class="lineNum">     490</span>              :     use ice_kinds_mod</span>
<span id="L491"><span class="lineNum">     491</span>              :     use ice_dyn_shared, only: brlx, revp, u0, cosw, sinw</span>
<span id="L492"><span class="lineNum">     492</span>              :     implicit none</span>
<span id="L493"><span class="lineNum">     493</span>              : </span>
<span id="L494"><span class="lineNum">     494</span>              :     ! arguments ------------------------------------------------------------------</span>
<span id="L495"><span class="lineNum">     495</span>              :     integer(kind=int_kind), intent(in)                           :: lb,ub</span>
<span id="L496"><span class="lineNum">     496</span>              :     integer(kind=int_kind), intent(in), dimension(:), contiguous :: nw,sw,sse</span>
<span id="L497"><span class="lineNum">     497</span>              :     logical(kind=log_kind), intent(in), dimension(:), contiguous :: skipme</span>
<span id="L498"><span class="lineNum">     498</span>              :     real   (kind=dbl_kind), intent(in), dimension(:), contiguous ::              &amp;</span>
<span id="L499"><span class="lineNum">     499</span>              :        Tbu,      &amp; ! coefficient for basal stress (N/m^2)   ! LCOV_EXCL_LINE</span>
<span id="L500"><span class="lineNum">     500</span>              :        uvel_init,&amp; ! x-component of velocity (m/s), beginning of timestep   ! LCOV_EXCL_LINE</span>
<span id="L501"><span class="lineNum">     501</span>              :        vvel_init,&amp; ! y-component of velocity (m/s), beginning of timestep   ! LCOV_EXCL_LINE</span>
<span id="L502"><span class="lineNum">     502</span>              :        aiX,      &amp; ! ice fraction on u-grid   ! LCOV_EXCL_LINE</span>
<span id="L503"><span class="lineNum">     503</span>              :        waterx,   &amp; ! for ocean stress calculation, x (m/s)   ! LCOV_EXCL_LINE</span>
<span id="L504"><span class="lineNum">     504</span>              :        watery,   &amp; ! for ocean stress calculation, y (m/s)   ! LCOV_EXCL_LINE</span>
<span id="L505"><span class="lineNum">     505</span>              :        forcex,   &amp; ! work array: combined atm stress and ocn tilt, x   ! LCOV_EXCL_LINE</span>
<span id="L506"><span class="lineNum">     506</span>              :        forcey,   &amp; ! work array: combined atm stress and ocn tilt, y   ! LCOV_EXCL_LINE</span>
<span id="L507"><span class="lineNum">     507</span>              :        Umassdti, &amp; ! mass of U-cell/dt (kg/m^2 s)   ! LCOV_EXCL_LINE</span>
<span id="L508"><span class="lineNum">     508</span>              :        uocn,     &amp; ! ocean current, x-direction (m/s)   ! LCOV_EXCL_LINE</span>
<span id="L509"><span class="lineNum">     509</span>              :        vocn,     &amp; ! ocean current, y-direction (m/s)   ! LCOV_EXCL_LINE</span>
<span id="L510"><span class="lineNum">     510</span>              :        fm,       &amp; ! Coriolis param. * mass in U-cell (kg/s)   ! LCOV_EXCL_LINE</span>
<span id="L511"><span class="lineNum">     511</span>              :        uarear,   &amp; ! 1/uarea   ! LCOV_EXCL_LINE</span>
<span id="L512"><span class="lineNum">     512</span>              :        Cw</span>
<span id="L513"><span class="lineNum">     513</span>              : </span>
<span id="L514"><span class="lineNum">     514</span>              :     real (kind=dbl_kind),dimension(:), intent(in),    contiguous ::              &amp;</span>
<span id="L515"><span class="lineNum">     515</span>              :        str1,str2,str3,str4,str5,str6,str7,str8</span>
<span id="L516"><span class="lineNum">     516</span>              :     real (kind=dbl_kind),dimension(:), intent(inout), contiguous ::              &amp;</span>
<span id="L517"><span class="lineNum">     517</span>              :        uvel, vvel</span>
<span id="L518"><span class="lineNum">     518</span>              :     ! basal stress coefficient</span>
<span id="L519"><span class="lineNum">     519</span>              :     real (kind=dbl_kind),dimension(:), intent(out), contiguous :: Cb</span>
<span id="L520"><span class="lineNum">     520</span>              : </span>
<span id="L521"><span class="lineNum">     521</span>              :     real (kind=dbl_kind), intent(in)  :: rhow</span>
<span id="L522"><span class="lineNum">     522</span>              : </span>
<span id="L523"><span class="lineNum">     523</span>              :     ! local variables</span>
<span id="L524"><span class="lineNum">     524</span>              :     integer (kind=int_kind) :: iw</span>
<span id="L525"><span class="lineNum">     525</span>              : </span>
<span id="L526"><span class="lineNum">     526</span>              :     real (kind=dbl_kind) ::&amp;</span>
<span id="L527"><span class="lineNum">     527</span> <span class="tlaGNC">        5760 :        uold, vold        , &amp; ! old-time uvel, vvel   ! LCOV_EXCL_LINE</span></span>
<span id="L528"><span class="lineNum">     528</span> <span class="tlaGNC">        5760 :        vrel              , &amp; ! relative ice-ocean velocity   ! LCOV_EXCL_LINE</span></span>
<span id="L529"><span class="lineNum">     529</span> <span class="tlaGNC">        5760 :        cca,ccb,ab2,cc1,cc2,&amp; ! intermediate variables   ! LCOV_EXCL_LINE</span></span>
<span id="L530"><span class="lineNum">     530</span> <span class="tlaGNC">        5760 :        taux, tauy,         &amp; ! part of ocean stress term   ! LCOV_EXCL_LINE</span></span>
<span id="L531"><span class="lineNum">     531</span> <span class="tlaGNC">        5760 :        strintx, strinty      ! internal strength, changed to scalar and calculated after</span></span>
<span id="L532"><span class="lineNum">     532</span>              :     real (kind=dbl_kind) ::                  &amp;</span>
<span id="L533"><span class="lineNum">     533</span> <span class="tlaGNC">        5760 :        tmp_str2_nw,tmp_str3_sse,tmp_str4_sw, &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L534"><span class="lineNum">     534</span> <span class="tlaGNC">        5760 :        tmp_str6_sse,tmp_str7_nw,tmp_str8_sw</span></span>
<span id="L535"><span class="lineNum">     535</span>              : </span>
<span id="L536"><span class="lineNum">     536</span>              :     character(len=*), parameter :: subname = '(stepu_1d)'</span>
<span id="L537"><span class="lineNum">     537</span>              : </span>
<span id="L538"><span class="lineNum">     538</span>              :     !-----------------------------------------------------------------------------</span>
<span id="L539"><span class="lineNum">     539</span>              :     ! integrate the momentum equation</span>
<span id="L540"><span class="lineNum">     540</span>              :     !-----------------------------------------------------------------------------</span>
<span id="L541"><span class="lineNum">     541</span>              : #ifdef _OPENMP_TARGET</span>
<span id="L542"><span class="lineNum">     542</span>              :     !$omp target teams distribute parallel do</span>
<span id="L543"><span class="lineNum">     543</span>              : #else</span>
<span id="L544"><span class="lineNum">     544</span>              :     !$omp parallel do schedule(runtime)                                        &amp;</span>
<span id="L545"><span class="lineNum">     545</span>              :     !$omp default(none)                                                        &amp;   ! LCOV_EXCL_LINE</span>
<span id="L546"><span class="lineNum">     546</span>              :     !$omp private(iw, tmp_str2_nw,tmp_str3_sse,tmp_str4_sw,                    &amp;   ! LCOV_EXCL_LINE</span>
<span id="L547"><span class="lineNum">     547</span>              :     !$omp         tmp_str6_sse,tmp_str7_nw,tmp_str8_sw,                        &amp;   ! LCOV_EXCL_LINE</span>
<span id="L548"><span class="lineNum">     548</span>              :     !$omp         vrel, uold, vold, taux, tauy, cca, ccb, ab2,                 &amp;   ! LCOV_EXCL_LINE</span>
<span id="L549"><span class="lineNum">     549</span>              :     !$omp         cc1, cc2,strintx, strinty)                                   &amp;   ! LCOV_EXCL_LINE</span>
<span id="L550"><span class="lineNum">     550</span>              :     !$omp shared(uvel,vvel,str1,str2,str3,str4,str5,str6,str7,str8,            &amp;   ! LCOV_EXCL_LINE</span>
<span id="L551"><span class="lineNum">     551</span>              :     !$omp        Cb,nw,sw,sse,skipme,Tbu,uvel_init,vvel_init,                  &amp;   ! LCOV_EXCL_LINE</span>
<span id="L552"><span class="lineNum">     552</span>              :     !$omp        aiX,waterx,watery,forcex,forcey,Umassdti,uocn,vocn,fm,uarear, &amp;   ! LCOV_EXCL_LINE</span>
<span id="L553"><span class="lineNum">     553</span> <span class="tlaGNC">      120960 :     !$omp           Cw,lb,ub,brlx, revp, rhow)</span></span>
<span id="L554"><span class="lineNum">     554</span>              : #endif</span>
<span id="L555"><span class="lineNum">     555</span> <span class="tlaUNC tlaBgUNC">           0 :     do iw = lb, ub</span></span>
<span id="L556"><span class="lineNum">     556</span> <span class="tlaUNC">           0 :       if (skipme(iw)) cycle</span></span>
<span id="L557"><span class="lineNum">     557</span>              : </span>
<span id="L558"><span class="lineNum">     558</span> <span class="tlaUNC">           0 :       uold = uvel(iw)</span></span>
<span id="L559"><span class="lineNum">     559</span> <span class="tlaUNC">           0 :       vold = vvel(iw)</span></span>
<span id="L560"><span class="lineNum">     560</span>              : </span>
<span id="L561"><span class="lineNum">     561</span>              :       ! (magnitude of relative ocean current)*rhow*drag*aice</span>
<span id="L562"><span class="lineNum">     562</span> <span class="tlaUNC">           0 :       vrel = aiX(iw)*rhow*Cw(iw)*sqrt((uocn(iw)-uold)**2+(vocn(iw)-vold)**2)</span></span>
<span id="L563"><span class="lineNum">     563</span>              :       ! ice/ocean stress</span>
<span id="L564"><span class="lineNum">     564</span> <span class="tlaUNC">           0 :       taux = vrel*waterx(iw) ! NOTE this is not the entire</span></span>
<span id="L565"><span class="lineNum">     565</span> <span class="tlaUNC">           0 :       tauy = vrel*watery(iw) ! ocn stress term</span></span>
<span id="L566"><span class="lineNum">     566</span>              : </span>
<span id="L567"><span class="lineNum">     567</span> <span class="tlaUNC">           0 :       Cb(iw)  = Tbu(iw) / (sqrt(uold**2 + vold**2) + u0) ! for basal stress</span></span>
<span id="L568"><span class="lineNum">     568</span>              : </span>
<span id="L569"><span class="lineNum">     569</span>              :       ! revp = 0 for classic evp, 1 for revised evp</span>
<span id="L570"><span class="lineNum">     570</span> <span class="tlaUNC">           0 :       cca = (brlx + revp)*umassdti(iw) + vrel * cosw + Cb(iw) ! kg/m^2 s</span></span>
<span id="L571"><span class="lineNum">     571</span> <span class="tlaUNC">           0 :       ccb = fm(iw) + sign(c1,fm(iw)) * vrel * sinw ! kg/m^2 s</span></span>
<span id="L572"><span class="lineNum">     572</span>              : </span>
<span id="L573"><span class="lineNum">     573</span> <span class="tlaUNC">           0 :       ab2 = cca**2 + ccb**2</span></span>
<span id="L574"><span class="lineNum">     574</span>              : </span>
<span id="L575"><span class="lineNum">     575</span> <span class="tlaUNC">           0 :       tmp_str2_nw = str2(nw(iw))</span></span>
<span id="L576"><span class="lineNum">     576</span> <span class="tlaUNC">           0 :       tmp_str3_sse = str3(sse(iw))</span></span>
<span id="L577"><span class="lineNum">     577</span> <span class="tlaUNC">           0 :       tmp_str4_sw = str4(sw(iw))</span></span>
<span id="L578"><span class="lineNum">     578</span> <span class="tlaUNC">           0 :       tmp_str6_sse = str6(sse(iw))</span></span>
<span id="L579"><span class="lineNum">     579</span> <span class="tlaUNC">           0 :       tmp_str7_nw = str7(nw(iw))</span></span>
<span id="L580"><span class="lineNum">     580</span> <span class="tlaUNC">           0 :       tmp_str8_sw = str8(sw(iw))</span></span>
<span id="L581"><span class="lineNum">     581</span>              : </span>
<span id="L582"><span class="lineNum">     582</span>              :       ! divergence of the internal stress tensor</span>
<span id="L583"><span class="lineNum">     583</span> <span class="tlaUNC">           0 :       strintx = uarear(iw)*(str1(iw)+tmp_str2_nw+tmp_str3_sse+tmp_str4_sw)</span></span>
<span id="L584"><span class="lineNum">     584</span> <span class="tlaUNC">           0 :       strinty = uarear(iw)*(str5(iw)+tmp_str6_sse+tmp_str7_nw+tmp_str8_sw)</span></span>
<span id="L585"><span class="lineNum">     585</span>              : </span>
<span id="L586"><span class="lineNum">     586</span>              :       ! finally, the velocity components</span>
<span id="L587"><span class="lineNum">     587</span> <span class="tlaUNC">           0 :       cc1 = strintx + forcex(iw) + taux &amp;</span></span>
<span id="L588"><span class="lineNum">     588</span> <span class="tlaUNC">           0 :             + umassdti(iw)*(brlx*uold + revp*uvel_init(iw))</span></span>
<span id="L589"><span class="lineNum">     589</span> <span class="tlaUNC">           0 :       cc2 = strinty + forcey(iw) + tauy &amp;</span></span>
<span id="L590"><span class="lineNum">     590</span> <span class="tlaUNC">           0 :             + umassdti(iw)*(brlx*vold + revp*vvel_init(iw))</span></span>
<span id="L591"><span class="lineNum">     591</span> <span class="tlaUNC">           0 :       uvel(iw) = (cca*cc1 + ccb*cc2) / ab2 ! m/s</span></span>
<span id="L592"><span class="lineNum">     592</span> <span class="tlaUNC">           0 :       vvel(iw) = (cca*cc2 - ccb*cc1) / ab2</span></span>
<span id="L593"><span class="lineNum">     593</span>              : </span>
<span id="L594"><span class="lineNum">     594</span>              :       ! calculate seabed stress component for outputs</span>
<span id="L595"><span class="lineNum">     595</span>              :       ! only needed on last iteration.</span>
<span id="L596"><span class="lineNum">     596</span>              :     enddo</span>
<span id="L597"><span class="lineNum">     597</span>              : </span>
<span id="L598"><span class="lineNum">     598</span>              : #ifdef _OPENMP_TARGET</span>
<span id="L599"><span class="lineNum">     599</span>              :     !$omp end target teams distribute parallel do</span>
<span id="L600"><span class="lineNum">     600</span>              : #else</span>
<span id="L601"><span class="lineNum">     601</span>              :     !$omp end parallel do</span>
<span id="L602"><span class="lineNum">     602</span>              : #endif</span>
<span id="L603"><span class="lineNum">     603</span> <span class="tlaGNC tlaBgGNC">      120960 :   end subroutine stepu_1d</span></span>
<span id="L604"><span class="lineNum">     604</span>              : </span>
<span id="L605"><span class="lineNum">     605</span>              :   !=============================================================================</span>
<span id="L606"><span class="lineNum">     606</span>              :   ! calculates strintx and strinty if needed</span>
<span id="L607"><span class="lineNum">     607</span> <span class="tlaGNC">         504 :   subroutine calc_diag_1d (lb     , ub     , &amp;</span></span>
<span id="L608"><span class="lineNum">     608</span> <span class="tlaGNC">         504 :                            uarear , skipme , &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L609"><span class="lineNum">     609</span> <span class="tlaGNC">         504 :                            str1   , str2   , &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L610"><span class="lineNum">     610</span> <span class="tlaGNC">         504 :                            str3   , str4   , &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L611"><span class="lineNum">     611</span> <span class="tlaGNC">         504 :                            str5   , str6   , &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L612"><span class="lineNum">     612</span> <span class="tlaGNC">         504 :                            str7   , str8   , &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L613"><span class="lineNum">     613</span> <span class="tlaGNC">         504 :                            nw     , sw     , &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L614"><span class="lineNum">     614</span> <span class="tlaGNC">         504 :                            sse    ,          &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L615"><span class="lineNum">     615</span> <span class="tlaGNC">         504 :                            strintx, strinty)</span></span>
<span id="L616"><span class="lineNum">     616</span>              : </span>
<span id="L617"><span class="lineNum">     617</span>              :     use ice_kinds_mod</span>
<span id="L618"><span class="lineNum">     618</span>              : </span>
<span id="L619"><span class="lineNum">     619</span>              :     real (kind=dbl_kind),dimension(:), intent(in),    contiguous ::  &amp;</span>
<span id="L620"><span class="lineNum">     620</span>              :        str1,str2,str3,str4,str5,str6,str7,str8</span>
<span id="L621"><span class="lineNum">     621</span>              :     real (kind=dbl_kind),dimension(:), intent(inout), contiguous ::  &amp;</span>
<span id="L622"><span class="lineNum">     622</span>              :        strintx, strinty</span>
<span id="L623"><span class="lineNum">     623</span>              : </span>
<span id="L624"><span class="lineNum">     624</span>              :     integer(kind=int_kind), intent(in)                           :: lb,ub</span>
<span id="L625"><span class="lineNum">     625</span>              :     integer(kind=int_kind), intent(in), dimension(:), contiguous :: nw,sw,sse</span>
<span id="L626"><span class="lineNum">     626</span>              :     logical(kind=log_kind), intent(in), dimension(:), contiguous :: skipme</span>
<span id="L627"><span class="lineNum">     627</span>              :     real   (kind=dbl_kind), intent(in), dimension(:), contiguous :: uarear</span>
<span id="L628"><span class="lineNum">     628</span>              : </span>
<span id="L629"><span class="lineNum">     629</span>              :   ! local variables</span>
<span id="L630"><span class="lineNum">     630</span>              :     integer (kind=int_kind) :: iw</span>
<span id="L631"><span class="lineNum">     631</span>              :     real (kind=dbl_kind) ::                 &amp;</span>
<span id="L632"><span class="lineNum">     632</span> <span class="tlaGNC">          24 :       tmp_str2_nw,tmp_str3_sse,tmp_str4_sw, &amp;   ! LCOV_EXCL_LINE</span></span>
<span id="L633"><span class="lineNum">     633</span> <span class="tlaGNC">          24 :       tmp_str6_sse,tmp_str7_nw,tmp_str8_sw</span></span>
<span id="L634"><span class="lineNum">     634</span>              : </span>
<span id="L635"><span class="lineNum">     635</span>              :     character(len=*), parameter :: subname = '(calc_diag_1d)'</span>
<span id="L636"><span class="lineNum">     636</span>              : </span>
<span id="L637"><span class="lineNum">     637</span>              : #ifdef _OPENMP_TARGET</span>
<span id="L638"><span class="lineNum">     638</span>              :     !$omp target teams distribute parallel do</span>
<span id="L639"><span class="lineNum">     639</span>              : #else</span>
<span id="L640"><span class="lineNum">     640</span>              :     !$omp parallel do schedule(runtime)                                   &amp;</span>
<span id="L641"><span class="lineNum">     641</span>              :     !$omp default(none)                                                   &amp;   ! LCOV_EXCL_LINE</span>
<span id="L642"><span class="lineNum">     642</span>              :     !$omp private(iw, tmp_str2_nw,tmp_str3_sse,tmp_str4_sw,               &amp;   ! LCOV_EXCL_LINE</span>
<span id="L643"><span class="lineNum">     643</span>              :     !$omp         tmp_str6_sse,tmp_str7_nw,tmp_str8_sw)                   &amp;   ! LCOV_EXCL_LINE</span>
<span id="L644"><span class="lineNum">     644</span>              :     !$omp shared(strintx,strinty,str1,str2,str3,str4,str5,str6,str7,str8, &amp;   ! LCOV_EXCL_LINE</span>
<span id="L645"><span class="lineNum">     645</span> <span class="tlaGNC">         504 :     !$omp        nw,sw,sse,skipme, uarear, lb,ub)</span></span>
<span id="L646"><span class="lineNum">     646</span>              : #endif</span>
<span id="L647"><span class="lineNum">     647</span>              : </span>
<span id="L648"><span class="lineNum">     648</span> <span class="tlaUNC tlaBgUNC">           0 :     do iw = lb, ub</span></span>
<span id="L649"><span class="lineNum">     649</span> <span class="tlaUNC">           0 :       if (skipme(iw)) cycle</span></span>
<span id="L650"><span class="lineNum">     650</span>              : </span>
<span id="L651"><span class="lineNum">     651</span> <span class="tlaUNC">           0 :       tmp_str2_nw = str2(nw(iw))</span></span>
<span id="L652"><span class="lineNum">     652</span> <span class="tlaUNC">           0 :       tmp_str3_sse = str3(sse(iw))</span></span>
<span id="L653"><span class="lineNum">     653</span> <span class="tlaUNC">           0 :       tmp_str4_sw = str4(sw(iw))</span></span>
<span id="L654"><span class="lineNum">     654</span> <span class="tlaUNC">           0 :       tmp_str6_sse = str6(sse(iw))</span></span>
<span id="L655"><span class="lineNum">     655</span> <span class="tlaUNC">           0 :       tmp_str7_nw = str7(nw(iw))</span></span>
<span id="L656"><span class="lineNum">     656</span> <span class="tlaUNC">           0 :       tmp_str8_sw = str8(sw(iw))</span></span>
<span id="L657"><span class="lineNum">     657</span>              : </span>
<span id="L658"><span class="lineNum">     658</span>              :       ! divergence of the internal stress tensor</span>
<span id="L659"><span class="lineNum">     659</span> <span class="tlaUNC">           0 :       strintx(iw) = uarear(iw)*(str1(iw)+tmp_str2_nw+tmp_str3_sse+tmp_str4_sw)</span></span>
<span id="L660"><span class="lineNum">     660</span> <span class="tlaUNC">           0 :       strinty(iw) = uarear(iw)*(str5(iw)+tmp_str6_sse+tmp_str7_nw+tmp_str8_sw)</span></span>
<span id="L661"><span class="lineNum">     661</span>              :     enddo</span>
<span id="L662"><span class="lineNum">     662</span>              : </span>
<span id="L663"><span class="lineNum">     663</span>              : #ifdef _OPENMP_TARGET</span>
<span id="L664"><span class="lineNum">     664</span>              :     !$omp end target teams distribute parallel do</span>
<span id="L665"><span class="lineNum">     665</span>              : #else</span>
<span id="L666"><span class="lineNum">     666</span>              :     !$omp end parallel do</span>
<span id="L667"><span class="lineNum">     667</span>              : #endif</span>
<span id="L668"><span class="lineNum">     668</span>              : </span>
<span id="L669"><span class="lineNum">     669</span> <span class="tlaGNC tlaBgGNC">         504 :   end subroutine calc_diag_1d</span></span>
<span id="L670"><span class="lineNum">     670</span>              : </span>
<span id="L671"><span class="lineNum">     671</span>              : end module ice_dyn_core1d</span>
        </pre>
              </td>
            </tr>
          </table>
          <br>

          <table width="100%" border=0 cellspacing=0 cellpadding=0>
            <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
            <tr><td class="versionInfo">Generated by: <a href="https://github.com//linux-test-project/lcov" target="_parent">LCOV version 2.0-1</a></td></tr>
          </table>
          <br>

</body>
</html>
